<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Word Battle — Играй!</title>

  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <style>
    /* ... (весь твой CSS без изменений) ... */

    .start-screen {
      text-align: center;
      padding: 20px;
    }
    .start-screen button {
      background: linear-gradient(90deg,#06b6d4,#3b82f6);
      color:white;
      padding:12px 20px;
      border-radius:12px;
      border:none;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 8px 20px rgba(59,130,246,0.2);
      font-size:16px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="game-card" role="application" aria-label="Word Battle game">
      <!-- Стартовый экран -->
      <div class="start-screen" id="startScreen">
        <h2>Word Battle</h2>
        <p>Нажми кнопку, чтобы начать игру</p>
        <button id="startBtn">Старт</button>
      </div>

      <!-- Основная игра -->
      <div id="gameWrapper" style="display:none;">
        <div class="top-row">
          <div class="score" aria-hidden="true">
            <div class="star" aria-hidden="true"></div>
            <div id="scoreValue">0</div>
          </div>
          <div class="title">Word Battle</div>
        </div>

        <div class="time-bar-wrap" aria-hidden="true" title="Оставшееся время">
          <div id="timeBar" class="time-bar"></div>
        </div>

        <div class="play-area">
          <div class="question" id="question">Загрузка...</div>
          <div class="hint" id="hint">Выберите правильный перевод</div>

          <div class="options" id="options" aria-live="polite" aria-atomic="true"></div>

          <div class="end-screen" id="endScreen">
            <h2>Игра окончена!</h2>
            <div class="end-score">Очки: <span id="finalPoints">0</span></div>
            <div class="end-score">Рекорд: <span id="bestScore">0</span></div>
            <div class="controls">
              <button class="primary" id="playAgain">Играть снова</button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const MAX_TIME = 7;
    const DELTA = 2;
    const ON_EACH_SECOND = 1000;

    let words = [
      ["apple","яблоко"],["dog","собака"],["car","машина"],
      ["house","дом"],["book","книга"]
    ];

    let timeLeft = MAX_TIME;
    let score = 0;
    let bestScore = parseInt(localStorage.getItem('wordBattleBest')||0);
    let current = null;
    let timerInterval = null;
    let awaitingCorrect = false;

    const scoreValue = document.getElementById('scoreValue');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timeBar = document.getElementById('timeBar');
    const endScreen = document.getElementById('endScreen');
    const finalPoints = document.getElementById('finalPoints');
    const bestPoints = document.getElementById('bestScore');
    const playAgainBtn = document.getElementById('playAgain');

    const startScreen = document.getElementById('startScreen');
    const startBtn = document.getElementById('startBtn');
    const gameWrapper = document.getElementById('gameWrapper');

    const btnClasses = ['c-1','c-2','c-3','c-4'];

    function shuffleArray(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

    function pickQuestion(){
      if (awaitingCorrect && current) return current;
      current = words[Math.floor(Math.random()*words.length)];
      awaitingCorrect = false;
      return current;
    }

    function renderQuestion(){
      const q = pickQuestion();
      if(!q) return;
      const [orig, trans] = q;
      questionEl.textContent = `Как переводится «${orig}»?`;
      let opts = [trans];
      const pool = words.map(w=>w[1]).filter(t=>t!==trans);
      shuffleArray(pool);
      for(let i=0; opts.length<4 && i<pool.length; i++) if(!opts.includes(pool[i])) opts.push(pool[i]);
      while(opts.length<4) opts.push("—");
      shuffleArray(opts);
      optionsEl.innerHTML = '';
      for(let i=0;i<opts.length;i++){
        const btn = document.createElement('button');
        btn.className = 'opt-btn '+btnClasses[i%btnClasses.length];
        btn.type='button';
        btn.textContent=opts[i];
        btn.dataset.value=opts[i];
        btn.onclick=()=>handleAnswer(btn);
        optionsEl.appendChild(btn);
      }
    }

    function updateTimeBar(){
      const ratio = Math.max(0, Math.min(1, timeLeft/MAX_TIME));
      timeBar.style.width = (ratio*100)+'%';
    }

    function startTimer(){ stopTimer(); timerInterval=setInterval(()=>{ timeLeft=Math.max(0,timeLeft-1); updateTimeBar(); if(timeLeft<=0) endGame(); }, ON_EACH_SECOND);}
    function stopTimer(){ if(timerInterval){ clearInterval(timerInterval); timerInterval=null; } }

    function handleAnswer(btn){
      if(!current) return;
      const selected = btn.dataset.value;
      const correct = current[1];
      if(selected==="—") return;
      if(selected===correct){
        btn.classList.add('correct');
        score++; scoreValue.textContent=score;
        timeLeft = Math.min(MAX_TIME,timeLeft+DELTA); updateTimeBar();
        awaitingCorrect=false;
        setTimeout(()=>{ renderQuestion(); },350);
      } else {
        btn.classList.add('wrong');
        timeLeft = Math.max(0,timeLeft-DELTA); updateTimeBar();
        awaitingCorrect=true;
        btn.disabled=true;
        if(timeLeft<=0) endGame();
      }
    }

    function endGame(){
      stopTimer();
      questionEl.style.display='none';
      document.getElementById('hint').style.display='none';
      optionsEl.style.display='none';
      endScreen.style.display='block';
      finalPoints.textContent=score;
      if(score>bestScore){ bestScore=score; localStorage.setItem('wordBattleBest',bestScore); }
      bestPoints.textContent=bestScore;
    }

    function resetGame(){
      timeLeft=MAX_TIME; score=0; current=null; awaitingCorrect=false;
      scoreValue.textContent='0';
      questionEl.style.display=''; document.getElementById('hint').style.display=''; optionsEl.style.display='';
      endScreen.style.display='none';
      renderQuestion(); updateTimeBar(); startTimer();
    }

    // запуск по кнопке "Старт"
    startBtn.addEventListener('click', ()=>{
      startScreen.style.display = 'none';
      gameWrapper.style.display = 'block';
      resetGame();
    });

    playAgainBtn.addEventListener('click', ()=> resetGame());
  </script>
</body>
</html>
