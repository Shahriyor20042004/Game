<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Word Battle</title>

<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@700;800&family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
:root{
  --bg1: #f0f4f8;
  --bg2: #ffffff;
  --card: #ffffff;
  --accent: #3b82f6;
  --good: #34D399;
  --bad: #FB7181;
  --radius: 14px;
  --shadow: rgba(0,0,0,0.08);
}

html,body{
  height:100%;
  margin:0;
  font-family: 'Poppins', sans-serif;
  display:flex;
  justify-content:center;
  align-items:center;
  background: linear-gradient(135deg, var(--bg1), var(--bg2));
}

.container{
  width:100%;
  max-width:400px;
}

.game-card{
  background: var(--card);
  border-radius: var(--radius);
  padding:20px;
  box-shadow: 0 8px 20px var(--shadow);
  text-align:center;
}

.title{
  font-weight:700;
  font-size:20px;
  margin-bottom:10px;
}

.score-board{
  margin-bottom:15px;
  font-weight:600;
  color:#1f2937;
}

.time-bar-wrap{
  width:100%;
  height:12px;
  background:#e5e7eb;
  border-radius:999px;
  overflow:hidden;
  margin-bottom:15px;
}

.time-bar{
  height:100%;
  width:100%;
  background: var(--accent);
  transition: width 0.1s linear;
}

.question{
  font-weight:700;
  font-size:18px;
  margin-bottom:10px;
  min-height:48px;
}

.options{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap:10px;
  margin-bottom:15px;
}

.opt-btn{
  padding:10px;
  border-radius:10px;
  border:none;
  background:#f3f4f6;
  cursor:pointer;
  font-weight:600;
  transition: transform 0.1s ease, box-shadow 0.1s ease;
}

.opt-btn.correct{ background: var(--good); color:white; }
.opt-btn.wrong{ background: var(--bad); color:white; }

#endScreen{
  display:none;
  margin-top:10px;
}

.controls button{
  margin-top:10px;
  padding:10px 14px;
  border:none;
  border-radius:10px;
  background: var(--accent);
  color:white;
  font-weight:700;
  cursor:pointer;
}

#startScreen{
  display:block;
}

</style>
</head>
<body>
<div class="container">
  <div class="game-card">
    <div class="title">Word Battle</div>
    
    <div id="startScreen">
      <div class="score-board">Рекорд: <span id="record">0</span></div>
      <button id="startBtn">Старт</button>
    </div>

    <div id="gameArea" style="display:none;">
      <div class="score-board">Очки: <span id="scoreValue">0</span></div>
      <div class="time-bar-wrap">
        <div id="timeBar" class="time-bar"></div>
      </div>
      <div class="question" id="question">Загрузка...</div>
      <div class="options" id="options"></div>
    </div>

    <div id="endScreen">
      <div>Игра окончена!</div>
      <div class="score-board">Очки: <span id="finalPoints">0</span></div>
      <div class="score-board">Рекорд: <span id="recordEnd">0</span></div>
      <div class="controls">
        <button id="playAgain">Играть снова</button>
      </div>
    </div>
  </div>
</div>

<script>
const MAX_TIME = 7; 
const DELTA = 2; 
const TICK = 50; // обновление каждые 50ms

let words = [
  ["apple","яблоко"],["dog","собака"],["car","машина"],
  ["house","дом"],["book","книга"]
];

let timeLeft = MAX_TIME;
let score = 0;
let record = 0;
let current = null;
let timerInterval = null;
let awaitingCorrect = false;

// DOM
const startScreen = document.getElementById('startScreen');
const gameArea = document.getElementById('gameArea');
const endScreen = document.getElementById('endScreen');
const startBtn = document.getElementById('startBtn');
const playAgainBtn = document.getElementById('playAgain');

const scoreValue = document.getElementById('scoreValue');
const recordEl = document.getElementById('record');
const questionEl = document.getElementById('question');
const optionsEl = document.getElementById('options');
const timeBar = document.getElementById('timeBar');
const finalPoints = document.getElementById('finalPoints');
const recordEnd = document.getElementById('recordEnd');

function shuffleArray(a){
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i], a[j]] = [a[j], a[i]];
  }
  return a;
}

function pickQuestion(){
  if(awaitingCorrect && current) return current;
  current = words[Math.floor(Math.random()*words.length)];
  awaitingCorrect = false;
  return current;
}

function renderQuestion(){
  const q = pickQuestion();
  if(!q) return;
  const [orig, trans] = q;
  questionEl.textContent = `Как переводится «${orig}»?`;

  let opts = [trans];
  const translationsPool = words.map(w => w[1]).filter(t => t!==trans);
  shuffleArray(translationsPool);
  for(let i=0; opts.length<4 && i<translationsPool.length; i++){
    if(!opts.includes(translationsPool[i])) opts.push(translationsPool[i]);
  }
  while(opts.length<4) opts.push("—");
  shuffleArray(opts);

  optionsEl.innerHTML = '';
  opts.forEach(opt=>{
    const btn = document.createElement('button');
    btn.className = 'opt-btn';
    btn.textContent = opt;
    btn.onclick = ()=>handleAnswer(btn);
    optionsEl.appendChild(btn);
  });
}

function updateTimeBar(){
  timeBar.style.width = (timeLeft/MAX_TIME*100)+'%';
}

function startTimer(){
  stopTimer();
  timerInterval = setInterval(()=>{
    timeLeft -= TICK/1000;
    if(timeLeft<=0){
      timeLeft=0;
      updateTimeBar();
      endGame();
    } else {
      updateTimeBar();
    }
  }, TICK);
}

function stopTimer(){
  if(timerInterval){ clearInterval(timerInterval); timerInterval=null; }
}

function handleAnswer(btn){
  const selected = btn.textContent;
  const correct = current[1];
  if(selected==="—") return;

  if(selected===correct){
    btn.classList.add('correct');
    score++;
    scoreValue.textContent = score;
    timeLeft = Math.min(MAX_TIME, timeLeft+DELTA);
    updateTimeBar();
    awaitingCorrect=false;
    setTimeout(()=>{renderQuestion();}, 300);
  } else {
    btn.classList.add('wrong');
    timeLeft = Math.max(0, timeLeft-DELTA);
    updateTimeBar();
    awaitingCorrect=true;
    btn.disabled=true;
    if(timeLeft<=0) endGame();
  }
}

function endGame(){
  stopTimer();
  gameArea.style.display='none';
  endScreen.style.display='block';
  finalPoints.textContent = score;
  record = Math.max(record, score);
  recordEl.textContent = record;
  recordEnd.textContent = record;
}

function resetGame(){
  timeLeft = MAX_TIME;
  score=0;
  awaitingCorrect=false;
  scoreValue.textContent = score;
  endScreen.style.display='none';
  gameArea.style.display='block';
  renderQuestion();
  startTimer();
}

startBtn.onclick = ()=>{
  startScreen.style.display='none';
  gameArea.style.display='block';
  renderQuestion();
  startTimer();
};

playAgainBtn.onclick = ()=>{ resetGame(); };
</script>
</body>
</html>
